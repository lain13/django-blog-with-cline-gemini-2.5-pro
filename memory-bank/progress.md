# Progress: Django TDD 블로그

## 1. 현재 상태 (Current Status)

- **진행률** 
  - v1.0: 100% 완료
  - v1.1: 100% 완료
  - v1.2: 100% 완료

- **현재 단계**: 사용자 인증 시스템 구현 착수 예정

## 2. 완료된 작업 (What Works)

- **v1.0**: 기본 블로그 기능 (게시글 CRUD, 댓글, 태그, 검색)
- **v1.1**: `Post` 모델에 `author` 필드 추가 및 2단계 마이그레이션을 통한 `makemigrations` 문제 해결
- **v1.2**: 계층형 카테고리 기능 (모델, 뷰, 템플릿, 테스트 포함)

## 3. 남은 작업 (What's Left to Build)

- **1. 템플릿 시스템 리팩토링 (Template System Refactoring)**
  - [x] TDD: `blog` 앱의 모든 주요 템플릿이 `base.html`을 상속하도록 리팩토링
  - [x] TDD: 템플릿 상속 구조를 검증하는 테스트(`test_templates.py`) 추가
- **2. 사용자 인증 시스템 (User Authentication) - `users` 앱**
  - [x] `users` 앱 생성 및 `settings.py` 등록
  - [x] `users.urls` 생성 및 `config.urls`에 연동
  - [x] TDD: 로그인/로그아웃 기능 구현 (Django 내장 `LoginView`, `LogoutView` 활용)
  - [x] TDD: 회원가입 기능 구현 (Django 내장 `UserCreationForm` 활용)
  - [x] `login.html`, `signup.html` 템플릿 작성
  - [x] 네비게이션 바에 로그인/로그아웃/회원가입 링크 추가
  - [x] TDD: `blog` 앱의 게시글 작성/수정/삭제 기능에 로그인 권한 적용
  - [x] TDD: 본인 게시글만 수정/삭제할 수 있도록 권한 검증 로직 추가
- **3. 계층형 카테고리 (Hierarchical Category)**
  - [x] `Category` 모델 정의 (self-referencing FK)
  - [x] `Post` 모델에 `category` FK 추가
  - [x] 카테고리 모델/관계 테스트 코드 작성 (TDD) - (Red-Green 사이클 완료)
  - [x] 카테고리별 포스트 목록 뷰/템플릿 구현
- **4. 댓글 시스템 개선 (Nested Comments)**
  - [x] `Comment` 모델 수정 (`author` FK, `parent` self-referencing FK, updated_at 필드 추가)
  - [x] 댓글 모델 테스트 코드 작성 (TDD)
  - [x] 댓글 생성/수정/삭제 로직 및 뷰/템플릿 업데이트 (인증/권한 적용)
- **5. 조회수 카운터 (View Count)**
  - [x] `Post` 모델에 `view_count` 필드 추가
  - [x] 중복 방지 로직을 포함한 조회수 증가 메서드 모델에 구현
  - [x] 조회수 기능 테스트 코드 작성 (TDD)
  - [x] 상세 페이지 뷰에 조회수 증가 로직 적용
- **6. 좋아요/싫어요 기능 (Like/Dislike System)**
  - [x] `Vote` 모델 정의 (`User` FK, `Post` FK, `value` field)
  - [x] `Post` 모델에 `votes` 관계 추가
  - [x] `Vote` 모델 테스트 코드 작성 (TDD)
  - [x] 좋아요/싫어요 처리 뷰/로직 구현 (AJAX)
  - [x] 좋아요/싫어요 카운트를 별도로 처리하기
- **7. 테스트 구조 리팩토링 (Test Structure Refactoring)**
  - [x] **계획 수립 및 문서화 (Planning & Documentation)**
    - [x] `activeContext.md`에 리팩토링 계획 반영
    - [x] `.clinerules/testing.md`에 파일 분리 예시 추가
    - [x] `.clinerules/workflow.md`에 선행 리팩토링 원칙 추가
    - [x] `progress.md`에 상세 리팩토링 계획 반영
  - [x] **`test_models.py` 분리 (Separate `test_models.py`)**
    - [x] `test_category_model.py` 생성 및 관련 테스트 이동
    - [x] `test_tag_model.py` 생성 및 관련 테스트 이동
    - [x] `test_post_model.py` 생성 및 관련 테스트 이동
    - [x] `test_comment_model.py` 생성 및 관련 테스트 이동
    - [x] `test_vote_model.py` 생성 및 관련 테스트 이동
    - [x] 기존 `test_models.py` 파일 삭제
  - [x] **`test_views.py` 분리 (Separate `test_views.py`)**
    - [x] `test_search_views.py` 생성 및 관련 테스트 이동
    - [x] `test_tag_views.py` 생성 및 관련 테스트 이동
    - [x] `test_category_views.py` 생성 및 관련 테스트 이동
    - [x] `test_post_views.py`는 Post CRUD 관련 테스트만 남도록 정리
  - [x] **`tests/__init__.py` 업데이트 (Update `tests/__init__.py`)**
    - [x] 분리된 모든 테스트 파일이 인식되도록 임포트 구문 수정
- **8. RSS 피드 기능 (RSS Feed)**
  - [x] RSS 피드 테스트 코드 작성 (TDD)
  - [x] Django의 `syndication` 프레임워크를 활용한 RSS 피드 클래스 구현
  - [x] 최신 게시글 RSS 피드 생성 (`/feed/`)
  - [x] RSS 피드 링크를 템플릿에 추가 (HTML `<link>` 태그)
  - [x] 카테고리별 RSS 피드 지원 (`/rss/category/<category>/`)
  - [x] RSS 피드 메타데이터 최적화 (제목, 설명, 게시일, 작성자 등)
- **8. 페이징 기능 (Pagination)**
  - [x] ListView 기반 뷰에 Django 기본 페이징 기능 적용 (Paginator, page_obj)
  - [x] 템플릿에 페이지 네비게이션 UI 추가 (has_previous, has_next, page_obj.paginator.page_range)
  - [x] 페이지 번호 쿼리스트링(?page=2)을 고려한 테스트 케이스 작성 (TDD)
  - [x] 태그별, 카테고리별, 검색결과 페이지에도 페이징 적용
  - [x] UX 향상을 위한 페이지 번호 하이라이트 및 비활성화 처리
  - [x] 페이지당 게시글 수 설정 (기본값: 10개, 설정값으로 조정 가능하게)
  - [x] 검색 결과와 페이징 동시 적용 시 쿼리스트링 보존 로직 추가 (?page=2&query=foo)
  - [x] 페이징 관련 테스트 코드 작성: 페이지 경계 테스트(첫 페이지, 마지막 페이지 등), 존재하지 않는 페이지 접근 시 graceful fallback
- **9. 캡차 기능 (CAPTCHA)**
  - [x] **환경 설정 (Environment Setup)**
    - [x] `django-simple-captcha` 패키지 설치 및 `requirements.txt` 업데이트
    - [x] `settings.py`에 `captcha` 앱 등록 및 `urls.py`에 연동
  - [x] **TDD: 회원가입 폼 적용**
    - [x] 회원가입 폼에 CAPTCHA 필드 적용
  - **[DONE] CAPTCHA 구현 리팩토링 및 안정화**
    - [x] **테스트 구조 복원**: `users/tests.py`를 `users/tests/` 패키지 구조로 복원
    - [x] **건너뛴 테스트 해결**: `@unittest.skip` 처리된 `test_signup_creates_new_user` 테스트 해결
    - [x] **코드 일관성 점검**: CAPTCHA 관련 코드 전반의 일관성 점검 및 리팩토링
  - **[DONE] TDD: 로그인/댓글 폼 적용**
    - [x] TDD: 로그인 폼에 CAPTCHA 필드 적용
    - [x] TDD: 댓글 작성 폼에 CAPTCHA 필드 적용
    - [x] API 키는 .env 파일에 분리하여 관리
    - [x] 유효성 검사는 clean() 또는 form_valid() 메서드에서 처리
    - [x] 실패 시 표준 Django 폼 에러 메시지 표시
    - [x] 관리자(admin) 페이지에는 reCAPTCHA 제외 (편의성 고려)
    - [x] 기본 단위 테스트 및 폼 유효성 테스트 추가 (TDD 기반)
    - [x] UX 고려: 로딩 최적화 및 접근성(A11Y) 기본 확보
- **10. REST API 기능**
  - [x] **환경 설정 (DRF Setup)**
    - [x] `djangorestframework` 패키지 설치 및 `requirements.txt` 업데이트
    - [x] `settings.py`에 `rest_framework` 및 `captcha` 앱 등록
  - [x] **TDD: `Post` 목록 API 구현 (`/api/posts/`)**
    - [x] `PostListAPIView` 및 `PostSerializer` 구현
    - [x] `blog/urls/api_urls.py` 설정 및 `config/urls.py` 연동
    - [x] `blog/tests/test_api_views.py` 작성 및 테스트 통과
  - [x] **TDD: `Post` 상세 API 구현 (`/api/posts/<pk>/`)**
    - [x] `PostDetailAPIView` 구현 및 URL 연동
    - [x] 상세 조회 기능 테스트 통과
  - [x] **인증 시스템: Token 인증**
    - [x] TDD: `rest_framework.authtoken`을 사용한 토큰 기반 인증 구현
    - [x] TDD: 인증된 사용자만 게시글을 생성할 수 있도록 `IsAuthenticatedOrReadOnly` 권한 적용
  - [x] **API 시스템 리팩토링 (API System Refactoring)**
    - [x] **Phase 1: 권한 체계 강화 (Permission System Enhancement)**
      - [x] TDD: `IsOwnerOrReadOnly` 커스텀 권한 클래스 구현 및 적용
    - [x] **Phase 2: URL 구조 개선 (URL Structure Refinement)**
      - [x] `users/urls/api_urls.py` 등 API용 URL 분리
      - [x] `config/urls.py`에 `/api/posts/`, `/api/users/` 경로 설정
    - [x] **Phase 3: 테스트 코드 리팩토링 (Test Code Refactoring)**
      - [x] 테스트 내 인증 로직을 `authenticate()` 헬퍼 메서드로 추상화
    - [x] **Phase 4: Serializer 구조화 (Serializer Structuring)**
      - [x] `UserSerializer` 도입 및 `PostSerializer`와 관계 재정의
  - **[Phase 1] 주요 API 엔드포인트 추가 (Major API Endpoints)**
    - [x] TDD: `Comment` CRUD API 구현
    - [x] TDD: `Category` Read-Only API 구현
    - [x] TDD: `Tag` Read-Only API 구현
  - **[Phase 2] 고급 기능 구현 (Advanced Features)**
    - [x] TDD: API 페이징(Pagination) 적용
    - [x] TDD: API 필터링(Filtering) 적용
    - [x] TDD: API 검색(Search) 적용
    - [x] TDD: API 정렬(Ordering) 적용
  - **[Phase 3] API 문서 자동화 (API Documentation)**
    - [ ] `drf-spectacular` 라이브러리 도입 및 설정
    - [ ] Swagger/OpenAPI 자동 문서 생성 확인
- **11. 리팩토링**
  - [x] **코드 주석 개선**: 프로젝트 전반의 소스 코드에 포함된 영어 주석을 한국어로 번역하여 코드 가독성을 향상시켰습니다.
  - [x] **코드 일관성 리팩토링**: 프로젝트 전반의 코드 스타일, 명명 규칙 등을 `.clinerules/codingStyle.md`에 따라 일관성 있게 수정합니다.
    - [x] **임포트 순서 정리 (완료)**: 프로젝트 내 모든 파이썬 파일의 임포트 순서를 규칙에 맞게 수정했습니다.
    - [x] **`users` 앱 폼 구조 개선**: `users/forms.py`를 기능 단위로 분리합니다.
      - [x] `users/forms/` 디렉토리 생성
      - [x] `users/forms/auth_forms.py` 생성 및 `LoginForm`, `SignupForm` 이동
      - [x] `users/forms/__init__.py` 생성 및 폼 임포트 설정
      - [x] `users/views/auth_views.py`의 임포트 경로 수정
      - [x] `users/tests/test_user_forms.py`의 임포트 경로 수정
      - [x] 기존 `users/forms.py` 파일 삭제
  - [x] **중복 코드 제거**: Helper 함수, Mixin 등을 활용하여 반복되는 로직을 추상화하고 제거합니다.
    - [x] `AuthorRequiredMixin`을 `blog/permissions.py`로 통합하여 뷰 코드의 중복 제거
    - [x] 누락되었던 `IsOwnerOrReadOnly` 권한 클래스를 `blog/permissions.py`에 추가하여 API 기능 복원
  - [x] **테스트 코드 리팩토링**: 테스트 코드 내 중복을 제거하고, `setUp` 및 `setUpTestData`를 최적화하여 테스트 효율성을 높입니다.
    - [x] **테스트 헬퍼 모듈 도입**: `blog/tests/helpers.py`를 생성하여 `create_user`, `create_post` 등 공통 함수를 추가했습니다.
    - [x] **`blog` 앱 뷰 테스트 리팩토링**: `test_post_views.py`, `test_comment_views.py`, `test_vote_views.py`에 헬퍼 함수를 적용하여 중복 코드를 제거했습니다.
    - [x] **`users` 앱 테스트 리팩토링**: `users` 앱 테스트에 헬퍼 함수를 적용했습니다. (`test_user_views.py` 분석 결과, 이미 헬퍼 함수를 적절히 사용하고 있어 추가 수정 불필요)
  - [x] **`requirements.txt` 정리**: 현재 사용하지 않는 불필요한 패키지가 있다면 제거합니다.
- **12. 국제화 (Internationalization - i18n)**
  - [x] **1. 환경 설정 (Setup)**
    - [x] `settings.py`에 국제화 관련 설정 추가 (`LANGUAGES`, `LANGUAGE_CODE`, `LOCALE_PATHS`, `MIDDLEWARE`).
  - [x] **2. TDD: URL 국제화**
    - [x] `config/urls.py`에 `i18n_patterns`를 적용하여 URL에 언어 코드가 포함되도록 수정 (`/ko/`, `/en/`).
    - [x] 언어 코드에 따라 올바른 페이지로 라우팅되는지 검증하는 테스트 작성.
  - [x] **3. TDD: 템플릿 번역**
    - [x] `base.html` 등 주요 템플릿에 `{% load i18n %}` 태그 추가.
    - [x] 네비게이션, 버튼, 제목 등 정적 텍스트를 `{% trans "text" %}` 또는 `{% blocktrans %}` 태그로 감싸 번역 대상으로 지정.
    - [x] 언어 설정에 따라 템플릿의 텍스트가 올바르게 번역되어 표시되는지 검증하는 테스트 작성.
  - [x] **4. TDD: 모델 및 뷰 번역**
    - [x] `Post`, `Category` 등 모델의 `verbose_name`이나 선택지(choices)와 같이 사용자에게 표시되는 부분을 `gettext_lazy`를 사용하여 번역.
    - [x] 뷰에서 전달하는 메시지(e.g., `messages.success`)를 `gettext`를 사용하여 번역.
    - [x] 모델과 뷰의 번역이 올바르게 적용되는지 검증하는 테스트 작성.
  - [x] **5. 번역 파일 생성 및 관리**
    - [x] `python manage.py makemessages -l ko -l en` 명령어로 번역 파일(`.po`) 생성.
    - [x] 생성된 `.po` 파일에 각 언어에 맞는 번역 텍스트 작성.
    - [x] `python manage.py compilemessages` 명령어로 번역 파일 컴파일.
  - [x] **6. 언어 전환 기능 구현**
    - [x] 사용자가 언어를 선택할 수 있는 UI (e.g., 드롭다운 메뉴)를 `base.html`에 추가.
    - [x] 언어 전환을 처리하는 뷰와 URL 구현.
    - [x] TDD: 언어 전환 기능 검증 테스트 추가

## 4. 알려진 이슈 (Known Issues)

### 현재 알려진 이슈 (Current Issues)
 - **[리팩토링 계획 완료]** `test_views.py` 파일이 너무 커서 수정하기 어려움. (다음 Task에서 분리 작업 예정)

### 과거에 해결된 이슈 (Resolved Issues)
 - **좋아요/싫어요 카운트 분리**: `Vote` 모델의 `value` 필드 하나로 집계되던 것을 `like_count`와 `dislike_count`로 분리하여 명확하게 표시하도록 개선했습니다.
 - **로그인/로그아웃 오류**: 로그인 시 `Page not found` 오류 및 로그아웃 시 `HTTP 405` 오류를 해결했습니다. (`settings.py`에 `LOGIN_REDIRECT_URL` 추가 및 `base.html`의 로그아웃 링크를 POST 방식으로 수정)
 - **`makemigrations` 실패**: Non-nullable 필드(`author`) 추가 시 `makemigrations`가 실패했으나, 2단계 마이그레이션 전략을 도입하여 해결했습니다. (관련 커밋: `6fecd16b`, `2599705c`)
 - **간헐적으로 실패하는 테스트**: `SearchView`의 비결정적 결과 순서로 인해 테스트가 간헐적으로 실패했으나, `order_by()`를 추가하고 테스트 방식을 개선하여 해결했습니다. (관련 커밋: `ca14c3e0`)
 - **템플릿 상속 구조 부재**: 초기 템플릿에 `base.html` 상속이 누락되어 UI 일관성이 부족했으나, 템플릿 리팩토링을 통해 해결했습니다. (관련 커밋: `9b375d9`, `19a7774`)
 - **태그 저장 로직 오류**: `PostForm`에서 태그를 저장하는 로직의 버그를 수정했습니다. (관련 커밋: `44159978`)
 - **네비게이션 링크 누락**: 일부 템플릿에 네비게이션 링크가 누락되었던 문제를 해결했습니다. (관련 커밋: `c9588974`)

## 5. 추가 고려사항 (Additional Considerations)

- **보안**: 로그인 후 리다이렉트 처리, CSRF 토큰 적용
- **UX**: 로그인이 필요한 페이지 접근 시 적절한 메시지 표시
- **테스팅**: 인증이 필요한 모든 기능에 대한 권한 테스트 케이스 추가
- **SEO**: RSS 피드를 통한 검색 엔진 최적화 및 콘텐츠 배포
- **캐싱**: RSS 피드 성능 최적화를 위한 캐싱 전략 고려
